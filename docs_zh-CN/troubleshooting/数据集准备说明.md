# nuScenes 数据集准备说明

## 当前状态

✅ **原始数据已准备**：
- `/media/ldk950413/data0/nuScenes/samples` ✓
- `/media/ldk950413/data0/nuScenes/sweeps` ✓
- `/media/ldk950413/data0/nuScenes/v1.0-trainval` ✓
- `/media/ldk950413/data0/nuScenes/calib.json` ✓

❌ **BEV处理后的数据缺失**：
- `/media/ldk950413/data0/nuScenes/img_dir/train` ✗
- `/media/ldk950413/data0/nuScenes/img_dir/val` ✗
- `/media/ldk950413/data0/nuScenes/ann_bev_dir/train` ✗
- `/media/ldk950413/data0/nuScenes/ann_bev_dir/val` ✗

## 数据准备步骤

### 步骤1: 检查数据预处理脚本

项目应该包含将原始 nuScenes 数据转换为 BEV 格式的脚本。请检查：

1. **查找数据预处理脚本**：
   ```bash
   find /media/ldk950413/data0/DiffBEV -name "*preprocess*" -o -name "*prepare*" -o -name "*convert*"
   find /media/ldk950413/data0/DiffBEV/scripts -type f
   ```

2. **检查 README 或文档**：
   - 查看 `README.md` 中的数据准备说明
   - 查看 `docs/dataset_prepare.md` 或类似文档

### 步骤2: 运行数据预处理

通常需要：

1. **提取图像数据**：
   - 从 nuScenes 原始数据中提取相机图像
   - 保存到 `img_dir/train` 和 `img_dir/val`

2. **生成BEV标注**：
   - 将 nuScenes 的 3D 标注转换为 BEV 语义分割标注
   - 保存到 `ann_bev_dir/train` 和 `ann_bev_dir/val`

### 步骤3: 验证数据

数据准备完成后，应该包含：

```
/media/ldk950413/data0/nuScenes/
├── img_dir/
│   ├── train/          # 训练图像
│   └── val/            # 验证图像
├── ann_bev_dir/
│   ├── train/          # 训练BEV标注
│   └── val/            # 验证BEV标注
├── samples/            # ✓ 已存在
├── sweeps/             # ✓ 已存在
├── v1.0-trainval/      # ✓ 已存在
└── calib.json          # ✓ 已存在
```

## 临时解决方案

如果暂时没有数据预处理脚本，可以：

1. **仅使用训练集**（跳过验证）：
   - 修改配置，暂时不加载验证集
   - 使用 `--no-validate` 参数

2. **创建空目录结构**（用于测试）：
   ```bash
   mkdir -p /media/ldk950413/data0/nuScenes/img_dir/{train,val}
   mkdir -p /media/ldk950413/data0/nuScenes/ann_bev_dir/{train,val}
   ```
   **注意**: 这只是为了测试代码流程，实际训练需要真实数据。

## 下一步操作

1. **查找数据预处理脚本**：
   ```bash
   cd /media/ldk950413/data0/DiffBEV
   find . -name "*.py" -path "*/scripts/*" -o -name "*nuscenes*preprocess*" -o -name "*nuscenes*prepare*"
   ```

2. **检查项目文档**：
   - 查看 README.md 中的数据集准备部分
   - 查看是否有数据预处理相关的脚本或说明

3. **联系项目维护者**：
   - 如果找不到预处理脚本，可能需要从原始项目仓库获取

## 当前配置

配置文件 (`configs/baseline/lss_swin_nuscenes.py`) 期望的数据路径：

```python
data = dict(
    train=dict(
        data_root="/media/ldk950413/data0/nuScenes",
        img_dir='img_dir/train',
        ann_dir='ann_bev_dir/train',
    ),
    val=dict(
        data_root="/media/ldk950413/data0/nuScenes",
        img_dir='img_dir/val',
        ann_dir='ann_bev_dir/val',
    ),
)
```

## 建议

1. **优先查找数据预处理脚本**：项目应该提供将 nuScenes 原始数据转换为 BEV 格式的脚本
2. **检查原始项目仓库**：如果当前代码库缺少预处理脚本，可能需要从原始 DiffBEV 项目获取
3. **参考 nuScenes devkit**：可能需要使用 nuScenes devkit 来提取和处理数据
