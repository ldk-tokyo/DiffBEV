# RTX 5090 GPU训练 - 当前状态与建议

## 已完成的工作

1. ✅ **PyTorch升级**: 1.9.1 → 2.4.1+cu124
2. ✅ **GPU操作测试**: PyTorch GPU tensor和卷积操作成功
3. ✅ **环境变量**: 已配置 `DIFFBEV_ALLOW_PYTORCH2=1`
4. ✅ **训练脚本**: `run_baseline_nuscenes.sh` 已更新

## 当前问题

**MMCV CUDA版本不匹配**:
- 系统CUDA: 13.0
- PyTorch CUDA: 12.4  
- MMCV需要匹配的CUDA版本

## 解决方案

### 选项1: 使用MMCV 1.3.15 (临时)

MMCV 1.3.15是为CUDA 11.1编译的，与PyTorch 2.4.1 (CUDA 12.4)理论上不兼容，
但可能可以通过动态库加载的方式工作（需要测试）。

**风险**: 可能有运行时错误或不稳定

### 选项2: CPU模式训练

已经实现了CPU模式支持，可以作为临时方案：

```bash
bash run_baseline_cpu.sh
```

**缺点**: 训练速度非常慢

### 选项3: 等待或手动编译MMCV

需要与系统CUDA版本匹配的MMCV，可能需要：
- 从源码编译MMCV（需要CUDA开发工具）
- 或等待官方发布匹配的预编译版本

## 建议

**立即行动**:
1. 测试MMCV 1.3.15是否能在PyTorch 2.4.1下工作
2. 如果能工作，继续GPU训练
3. 如果不能工作，使用CPU模式进行小规模测试

**长期方案**:
- 解决CUDA版本匹配问题
- 或等待PyTorch官方发布完整支持sm_120的版本

## 测试命令

```bash
# 测试MMCV
export DIFFBEV_ALLOW_PYTORCH2=1
python -c "from mmcv.ops import nms; print('MMCV可用')"

# 测试训练启动
cd /media/ldk950413/data0/DiffBEV
export DIFFBEV_ALLOW_PYTORCH2=1
python tools/train.py configs/baseline/lss_swin_nuscenes.py --work-dir runs/baseline --gpu-ids 0
```
