# DiffBEV 运行环境说明

## 环境要求

本项目需要在 `diffbev` 环境中运行。

## 激活环境

使用以下命令激活环境：

```bash
micromamba activate diffbev
```

## 环境验证

激活环境后，建议验证关键依赖是否正确安装：

```bash
# 检查 Python 版本
python --version

# 检查 PyTorch
python -c "import torch; print(torch.__version__)"

# 检查 mmcv
python -c "import mmcv; print(mmcv.__version__)"

# 检查 mmsegmentation
python -c "import mmseg; print(mmseg.__version__)"
```

## 常用命令

### 训练模型

```bash
# 1. 激活环境
micromamba activate diffbev

# 2. 进入项目目录
cd /media/ldk950413/data0/DiffBEV

# 3. 开始训练
python tools/train.py <config_file> \
    --work-dir <work_dir> \
    --gpu-ids <gpu_id>
```

### 测试模型

```bash
# 1. 激活环境
micromamba activate diffbev

# 2. 进入项目目录
cd /media/ldk950413/data0/DiffBEV

# 3. 运行测试
python tools/test.py <config_file> <checkpoint> \
    --eval mIoU \
    --show-dir <output_dir>
```

### 可视化结果

```bash
# 1. 激活环境
micromamba activate diffbev

# 2. 使用提供的可视化脚本
python tools/test.py <config_file> <checkpoint> \
    --eval mIoU \
    --show-dir <vis_output_dir>
```

## 注意事项

1. **每次运行前必须激活环境**：`micromamba activate diffbev`
2. **确保数据集路径正确**：检查 `configs/_base_/datasets/nuscene.py` 中的 `data_root` 设置
3. **检查 GPU 可用性**：使用 `nvidia-smi` 确认 GPU 状态
4. **内存要求**：确保有足够的 GPU 内存（建议至少 16GB）

## 环境配置详情

### 版本要求（重要）

**⚠️ 注意：本项目不支持PyTorch 2.x！**

如果环境未正确配置，可以参考以下信息：

- **Python**: 3.7/3.8
- **PyTorch**: **1.9.1** （不支持2.x）
- **torchvision**: 0.10.1
- **CUDA**: 11.1
- **MMCV**: 1.3.13 - 1.4.0（仅支持PyTorch 1.x）
- **MMSegmentation**: 0.18.0（基于此项目版本）

### 版本兼容性

| 组件 | 支持版本 | 不支持版本 |
|------|---------|-----------|
| PyTorch | 1.x (推荐1.9.1) | ❌ 2.x (2.0, 2.1, 2.5等) |
| MMCV | 1.3.13 - 1.4.0 | ❌ 2.x |

详细说明请参考：**版本兼容性说明.md**

## 故障排除

### 问题：找不到 diffbev 环境

```bash
# 检查可用环境列表
micromamba env list

# 如果环境不存在，需要创建（参考原始 README 的安装说明）
```

### 问题：导入模块失败

```bash
# 确保在项目根目录下，且已安装
cd /media/ldk950413/data0/DiffBEV
pip install -v -e .
```

### 问题：CUDA 相关问题

```bash
# 检查 CUDA 版本
nvcc --version

# 检查 PyTorch 是否能识别 GPU
python -c "import torch; print(torch.cuda.is_available())"
```
