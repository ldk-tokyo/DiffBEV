# 实时监控脚本使用说明

## 🚀 快速开始

### 方式1: 直接运行（最简单，推荐）⭐

**直接运行脚本，自动刷新：**

```bash
bash /media/ldk950413/data0/DiffBEV/实时监控（直接运行版）.sh
```

**或者指定刷新间隔（默认2秒）：**

```bash
bash /media/ldk950413/data0/DiffBEV/实时监控（直接运行版）.sh 3  # 每3秒刷新
```

**特点：**
- ✅ 无需额外命令，直接运行即可
- ✅ 内置自动刷新功能
- ✅ 按 Ctrl+C 停止
- ✅ 自动清屏，显示最新状态

---

### 方式2: 使用启动脚本

**使用watch命令（如果系统支持）：**

```bash
bash /media/ldk950413/data0/DiffBEV/启动实时监控.sh
```

**或者指定刷新间隔：**

```bash
bash /media/ldk950413/data0/DiffBEV/启动实时监控.sh 3  # 每3秒刷新
```

**特点：**
- ✅ 自动检测系统是否支持watch命令
- ✅ 如果不支持watch，自动使用内置循环
- ✅ 带颜色输出（如果支持）

---

### 方式3: 手动使用watch命令

```bash
watch -n 2 -c bash /media/ldk950413/data0/DiffBEV/实时监控训练.sh
```

**参数说明：**
- `-n 2`: 每2秒刷新一次（可以改为其他数字）
- `-c`: 启用颜色输出
- 按 Ctrl+C 停止

---

### 方式4: 简洁版监控

```bash
watch -n 2 bash /media/ldk950413/data0/DiffBEV/简洁监控训练.sh
```

**特点：**
- 只显示关键信息
- 界面更简洁

---

## 📊 监控信息说明

实时监控脚本会显示以下信息：

1. **训练进程状态**
   - ✅ 进程是否运行
   - CPU和内存使用率
   - 运行时间

2. **GPU状态**
   - 使用率（颜色指示：绿色=高，黄色=中，红色=低）
   - 显存使用情况
   - 温度和功耗

3. **训练进度**
   - 当前迭代数 / 总迭代数
   - 进度百分比
   - 可视化进度条
   - 剩余迭代数

4. **训练指标**
   - 总损失
   - 分割损失（如果存在）
   - 深度损失（如果存在）
   - 扩散损失（如果存在）

5. **学习率**
   - 当前学习率

6. **评估指标**（如果有）
   - mIoU等评估指标

7. **Checkpoint信息**
   - 最新保存的checkpoint
   - 保存时间和大小

8. **日志信息**
   - 最新日志文件名
   - 日志更新时间

---

## 🛠️ 故障排除

### Q1: 监控显示"未检测到训练进程"

**可能原因：**
- 训练确实没有运行
- 训练刚启动，进程还未完全初始化
- 进程名称不匹配

**解决方案：**
1. 检查训练进程：`ps aux | grep train`
2. 启动训练：`bash /media/ldk950413/data0/DiffBEV/快速训练.sh`
3. 等待几分钟后再检查（训练启动需要一些时间）

### Q2: 监控信息不更新

**可能原因：**
- 日志文件很久没更新（训练可能在初始化）
- 日志输出频率较低（每50次迭代记录一次）

**解决方案：**
1. 查看最新日志：`tail -f /media/ldk950413/data0/DiffBEV/runs/baseline/最新日志.log`
2. 检查GPU是否在使用：`nvidia-smi`
3. 如果GPU使用率为0%，训练可能卡住了

### Q3: 脚本运行很慢或卡顿

**可能原因：**
- 刷新间隔太短
- 日志文件太大

**解决方案：**
1. 增加刷新间隔：`bash 实时监控（直接运行版）.sh 5` （每5秒刷新）
2. 使用简洁版监控脚本

---

## 💡 使用技巧

### 技巧1: 后台运行训练和监控

```bash
# 终端1: 启动训练
bash /media/ldk950413/data0/DiffBEV/快速训练.sh

# 终端2: 启动监控
bash /media/ldk950413/data0/DiffBEV/实时监控（直接运行版）.sh
```

### 技巧2: 使用screen/tmux

```bash
# 创建screen会话
screen -S training_monitor

# 启动监控
bash /media/ldk950413/data0/DiffBEV/实时监控（直接运行版）.sh

# 按 Ctrl+A 然后按 D 分离会话

# 重新连接
screen -r training_monitor
```

### 技巧3: 同时查看日志

```bash
# 终端1: 实时监控
bash /media/ldk950413/data0/DiffBEV/实时监控（直接运行版）.sh

# 终端2: 实时查看日志
tail -f /media/ldk950413/data0/DiffBEV/runs/baseline/$(ls -t /media/ldk950413/data0/DiffBEV/runs/baseline/*.log | head -1 | xargs basename)
```

---

## 📝 脚本文件说明

| 脚本名称 | 功能 | 使用场景 |
|---------|------|---------|
| `实时监控（直接运行版）.sh` | 直接运行，自动刷新 | ⭐ **推荐**：最简单的使用方式 |
| `启动实时监控.sh` | 启动脚本，自动选择最佳方式 | 推荐：智能检测系统支持 |
| `实时监控训练.sh` | 核心监控脚本 | 可被其他脚本调用，或手动使用watch |
| `简洁监控训练.sh` | 简洁版监控 | 需要简洁界面时使用 |

---

## ⚡ 性能优化

- **默认刷新间隔**: 2秒（平衡实时性和性能）
- **推荐刷新间隔**: 
  - 快速迭代时：2-3秒
  - 慢速迭代时：5-10秒
  - 长时间监控：10-30秒

---

## 🎯 推荐工作流

1. **启动训练**
   ```bash
   bash /media/ldk950413/data0/DiffBEV/快速训练.sh
   ```

2. **启动监控**（新终端）
   ```bash
   bash /media/ldk950413/data0/DiffBEV/实时监控（直接运行版）.sh
   ```

3. **查看日志**（如果需要详细信息）
   ```bash
   tail -f /media/ldk950413/data0/DiffBEV/runs/baseline/最新日志.log
   ```

享受实时监控！🎉
