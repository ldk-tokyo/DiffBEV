# nuScenes 地图扩展文件下载指南

## 问题说明

根据检查结果，当前 nuScenes 数据集**缺少地图扩展 JSON 文件**，这些文件是生成 BEV 标注所必需的。

### 为什么需要这些文件？

`make_nuscenes_labels.py` 脚本使用 `NuScenesMap` 类来：
- 加载地图几何数据（道路、人行道、车道线等）
- 生成 BEV 语义分割标注
- 处理静态和动态物体

`NuScenesMap` 期望文件路径：`{dataroot}/maps/expansion/{location}.json`

## 下载方式

### 方式1: 使用提供的下载脚本（推荐）

```bash
cd /media/ldk950413/data0/DiffBEV
bash 下载地图扩展文件.sh
```

脚本会自动：
1. 检查文件是否已存在
2. 从 Zenodo 下载 `nuScenes-map-expansion-v1.3.zip`
3. 解压到正确位置
4. 验证文件完整性

### 方式2: 手动下载

1. **访问 Zenodo 下载页面**:
   - URL: https://zenodo.org/record/15667707
   - 文件名: `nuScenes-map-expansion-v1.3.zip`
   - 大小: 约 398.5 MB

2. **下载文件**:
   ```bash
   cd /media/ldk950413/data0/nuScenes
   wget https://zenodo.org/record/15667707/files/nuScenes-map-expansion-v1.3.zip
   ```

3. **解压文件**:
   ```bash
   unzip nuScenes-map-expansion-v1.3.zip
   ```

4. **验证**:
   ```bash
   ls -la /media/ldk950413/data0/nuScenes/maps/expansion/*.json
   # 应该看到 4 个 JSON 文件
   ```

## 为什么不在 nuScenes 官网？

根据官网说明：
- **Metadata 包**（0.43 GB）只包含：
  - JSON 元数据文件
  - 地图图片（PNG）
  - **不包含**地图扩展的 JSON 几何数据

- **地图扩展文件**需要单独从 **Zenodo** 下载
  - 这是因为地图扩展是后来发布的附加数据
  - 不是所有用户都需要，所以单独提供

## 验证文件

下载并解压后，应该有以下结构：

```
/media/ldk950413/data0/nuScenes/
├── maps/
│   ├── expansion/                    ← 解压后创建
│   │   ├── boston-seaport.json      ← 需要
│   │   ├── singapore-onenorth.json  ← 需要
│   │   ├── singapore-queenstown.json ← 需要
│   │   └── singapore-hollandvillage.json ← 需要
│   ├── *.png                        ✓ (已有)
│   └── ...
└── ...
```

运行检查脚本验证：

```bash
bash /media/ldk950413/data0/DiffBEV/检查地图文件.sh
```

## 版本兼容性

- **v1.3 地图扩展** 兼容 **v1.0-trainval** 数据集
- 如果下载的是 v1.0 版本的地图扩展也可以使用
- 推荐使用 v1.3（包含更多图层和改进）

## 常见问题

### Q: 为什么官网的 Metadata 包中没有这些文件？
A: 地图扩展文件是后来发布的附加数据，需要单独下载。

### Q: 可以从 nuScenes 官网下载吗？
A: 不可以。地图扩展文件只在 Zenodo 提供。

### Q: 文件大小是多少？
A: 压缩包约 398.5 MB，解压后可能更大。

### Q: 下载后如何验证？
A: 运行 `bash 检查地图文件.sh` 或手动检查 `maps/expansion/` 目录是否有 4 个 JSON 文件。

## 下一步

下载并解压地图扩展文件后：

1. **验证文件完整性**:
   ```bash
   bash /media/ldk950413/data0/DiffBEV/检查地图文件.sh
   ```

2. **运行数据准备脚本**:
   ```bash
   bash /media/ldk950413/data0/DiffBEV/prepare_nuscenes_bev_data.sh
   ```

3. **开始训练**:
   ```bash
   bash /media/ldk950413/data0/DiffBEV/run_baseline_nuscenes.sh
   ```
