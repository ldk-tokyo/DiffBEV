# DiffBEV 论文复现规范

**重要**：本文档记录了从论文中人工整理并确认无误的复现规范，所有代码分析、修改与实验设计必须严格以此为准。

## 数据集规范

- **数据集**：nuScenes v1.0-trainval（完整训练验证集，非mini版本）
- **数据集路径**：`/media/ldk950413/data0/nuscenes/`
- **数据版本**：v1.0

## 任务规范

### BEV语义分割任务
- **评估指标**：
  - mIoU（平均交并比）
  - 各类IoU（每个类别的交并比）
- **输出**：14个语义类别的BEV分割结果

### 3D目标检测任务
- **评估指标**：
  - NDS（nuScenes Detection Score）
  - mAP（平均精度）
  - ATE（Average Translation Error，平均平移误差）
  - ASE（Average Scale Error，平均尺度误差）
  - AOE（Average Orientation Error，平均方向误差）
  - AVE（Average Velocity Error，平均速度误差）
  - AAE（Average Attribute Error，平均属性误差）

## 训练超参数规范

### 优化器配置
- **类型**：AdamW
- **学习率（lr）**：2e-4（0.0002）
- **权重衰减（weight_decay）**：0.01

### 训练配置
- **总迭代次数**：200,000 iterations
- **Warmup迭代次数**：1,500 iterations
- **输入分辨率**：800×600
- **Batch Size**：4 per GPU（每个GPU 4个样本）

## 损失函数规范

### 语义分割损失（Lseg）
```
Lseg = Lwce + 10*Ldepth + 1*Ldiff
```
- **Lwce**：加权交叉熵损失（Weighted Cross Entropy）
- **Ldepth**：深度损失（Depth Loss），权重系数：10
- **Ldiff**：扩散模型损失（Diffusion Loss），权重系数：1

### 3D检测损失（Ldet）
```
Ldet = Ldetect + 10*Ldepth + 1*Ldiff
```
- **Ldetect**：检测损失（Detection Loss）
- **Ldepth**：深度损失（Depth Loss），权重系数：10
- **Ldiff**：扩散模型损失（Diffusion Loss），权重系数：1

## DiffBEV关键结构规范

### 条件类型支持
- **FO-BEV**：First-Order BEV条件
- **FS-BEV**：Full-Scale BEV条件
- **sum条件**：求和条件

### 特征融合方式
支持三种融合方式：
- **Concat**：特征拼接融合
- **Add**：特征相加融合
- **Cross-Attention**：跨注意力融合

### xt编码方式
支持两种xt编码方式：
- **Conv**：卷积编码
- **Self-Attention**：自注意力编码

## 配置文件位置

已创建符合规范的配置文件：

- **训练计划配置**：`configs/_base_/schedules/schedule_200k_nuscenes.py`
  - 优化器：AdamW，lr=2e-4，weight_decay=0.01
  - 训练迭代：200k iterations
  - Warmup：1,500 iterations

- **nuScenes训练配置**：`configs/pyva/pyva_swin_nuscenes.py`
  - 数据集：nuScenes v1.0-trainval
  - 输入分辨率：800×600
  - Batch size：4 per GPU
  - 任务：BEV语义分割（14个类别）

## 配置检查清单

在进行训练和实验前，请确认以下配置符合规范：

- [ ] 数据集版本：nuScenes v1.0-trainval
- [ ] 优化器：AdamW，lr=2e-4，weight_decay=0.01
- [ ] 训练迭代：200k iterations
- [ ] Warmup：1,500 iterations
- [ ] 输入分辨率：800×600
- [ ] Batch size：4 per GPU
- [ ] 损失函数权重：Ldepth权重=10，Ldiff权重=1（需要在模型实现中确认）
- [ ] DiffBEV结构配置正确（FO-BEV/FS-BEV/sum条件，融合方式等）

## 注意事项

1. **不可更改**：以上所有规范都来自论文确认，不得随意修改
2. **严格遵循**：所有实验配置必须严格按照此规范执行
3. **版本确认**：确保使用nuScenes v1.0完整数据集，不是mini版本
4. **指标记录**：需要同时记录BEV分割和3D检测的所有指标

## 实验记录要求

每次实验需要记录：
- 配置参数（是否完全符合规范）
- 训练日志（损失曲线、学习率曲线）
- 评估结果（mIoU、各类IoU、NDS、mAP、ATE、ASE、AOE、AVE、AAE）
- 可视化结果（BEV分割结果、3D检测结果）
- 不同条件类型和融合方式的对比结果
