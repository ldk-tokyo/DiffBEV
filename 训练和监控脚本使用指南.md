# 训练和监控脚本使用指南

## 📁 目录结构

```
scripts/
├── training/          # 训练脚本
│   ├── 快速训练.sh           ⭐ 推荐
│   ├── 完整训练命令.sh
│   ├── GPU训练启动脚本.sh
│   ├── run_baseline_cpu.sh
│   └── run_baseline_nuscenes.sh
└── monitoring/        # 监控脚本
    ├── 实时监控训练.sh        ⭐ 推荐
    ├── 启动实时监控.sh        ⭐ 推荐（自动刷新）
    ├── 实时监控（直接运行版）.sh
    ├── 简洁监控训练.sh
    └── 监控训练.sh
```

## 🚀 快速开始

### 步骤1: 启动训练

```bash
cd /media/ldk950413/data0/DiffBEV
bash scripts/training/快速训练.sh
```

### 步骤2: 启动监控（新终端）

```bash
cd /media/ldk950413/data0/DiffBEV
bash scripts/monitoring/实时监控训练.sh
```

## 📖 详细说明

### 训练脚本

| 脚本名称 | 推荐度 | 说明 |
|---------|--------|------|
| `快速训练.sh` | ⭐⭐⭐⭐⭐ | 最简单快捷，推荐首次使用 |
| `完整训练命令.sh` | ⭐⭐⭐⭐ | 包含环境激活，适合复杂环境 |
| `GPU训练启动脚本.sh` | ⭐⭐⭐ | GPU训练专用 |
| `run_baseline_*.sh` | ⭐⭐ | 基线实验脚本 |

**完整训练命令示例**:
```bash
# 方式1: 快速训练（推荐）
bash scripts/training/快速训练.sh

# 方式2: 完整训练（包含环境激活）
bash scripts/training/完整训练命令.sh

# 方式3: GPU训练
bash scripts/training/GPU训练启动脚本.sh
```

### 监控脚本

| 脚本名称 | 推荐度 | 说明 | 刷新方式 |
|---------|--------|------|----------|
| `实时监控训练.sh` | ⭐⭐⭐⭐⭐ | 最详细的信息 | 手动刷新 |
| `启动实时监控.sh` | ⭐⭐⭐⭐⭐ | 自动刷新（推荐） | 自动刷新 |
| `实时监控（直接运行版）.sh` | ⭐⭐⭐⭐ | 内置自动刷新 | 自动刷新 |
| `简洁监控训练.sh` | ⭐⭐⭐ | 简洁版监控 | 手动/配合watch |
| `监控训练.sh` | ⭐⭐ | 基础监控 | 手动 |

**监控命令示例**:
```bash
# 方式1: 实时监控（详细信息，手动刷新）
bash scripts/monitoring/实时监控训练.sh

# 方式2: 自动刷新监控（推荐，使用watch或内置循环）
bash scripts/monitoring/启动实时监控.sh
# 或指定刷新间隔
bash scripts/monitoring/启动实时监控.sh 5

# 方式3: 直接运行版（内置自动刷新）
bash scripts/monitoring/实时监控（直接运行版）.sh
# 或指定刷新间隔
bash scripts/monitoring/实时监控（直接运行版）.sh 5

# 方式4: 使用watch命令（简洁版）
watch -n 2 -c bash scripts/monitoring/简洁监控训练.sh
```

## 🎯 常用场景

### 场景1: 首次训练

```bash
# 终端1: 启动训练
cd /media/ldk950413/data0/DiffBEV
bash scripts/training/快速训练.sh

# 终端2: 启动监控
cd /media/ldk950413/data0/DiffBEV
bash scripts/monitoring/启动实时监控.sh
```

### 场景2: 后台训练 + 监控

```bash
# 启动后台训练
cd /media/ldk950413/data0/DiffBEV
nohup bash scripts/training/快速训练.sh > train.log 2>&1 &

# 启动监控
cd /media/ldk950413/data0/DiffBEV
bash scripts/monitoring/实时监控训练.sh
```

### 场景3: 使用screen/tmux

```bash
# 启动screen会话
screen -S training

# 在screen中启动训练
cd /media/ldk950413/data0/DiffBEV
bash scripts/training/快速训练.sh

# 按 Ctrl+A, D 分离screen

# 新终端启动监控
cd /media/ldk950413/data0/DiffBEV
bash scripts/monitoring/启动实时监控.sh

# 重新连接screen: screen -r training
```

## 📊 监控信息说明

### 训练进度
- **迭代数**: 当前迭代 / 总迭代数
- **进度**: 百分比进度条
- **速度**: 迭代/分钟

### 指标
- **Loss**: 总损失、分割损失、深度损失、扩散损失
- **mIoU**: 平均IoU值（如果有评估）
- **学习率**: 当前学习率

### 资源
- **GPU**: 显存使用、GPU利用率、温度
- **CPU**: CPU使用率
- **内存**: 内存占用

### 时间
- **已运行**: 训练已运行的时间
- **剩余时间**: 基于当前速度估算
- **预计完成**: 训练预计完成的时间点

## 🛠️ 故障排除

### 监控脚本无法检测到训练

1. 检查训练是否在运行:
   ```bash
   ps aux | grep train.py
   ```

2. 使用诊断脚本:
   ```bash
   bash scripts/utils/诊断训练进程.sh
   ```

3. 检查日志文件:
   ```bash
   ls -lth runs/baseline/*.log | head -5
   ```

### 路径问题

所有脚本都需要在项目根目录运行:
```bash
cd /media/ldk950413/data0/DiffBEV
# 然后运行脚本
bash scripts/training/快速训练.sh
```

## 📚 更多文档

- 训练脚本详细说明: `scripts/training/启动说明.md`
- 监控脚本详细说明: `scripts/monitoring/启动说明.md`
- 脚本总览: `scripts/README.md`
- 快速开始: `快速开始.md`

